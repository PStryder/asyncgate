# AsyncGate Environment Configuration
# Copy this file to .env and customize for your environment

# ============================================================================
# General
# ============================================================================
ASYNCGATE_ENV=development
# Options: development, staging, production

ASYNCGATE_INSTANCE_ID=asyncgate-1
# Auto-detected if not set

ASYNCGATE_LOG_LEVEL=INFO
# Options: DEBUG, INFO, WARNING, ERROR, CRITICAL

ASYNCGATE_DEBUG=false


# ============================================================================
# Database
# ============================================================================
ASYNCGATE_DATABASE_URL=postgresql+asyncpg://asyncgate:asyncgate@localhost:5432/asyncgate


# ============================================================================
# Security (P0.3 - CORS Configuration)
# ============================================================================
# CORS Allowed Origins (comma-separated, NO WILDCARDS with credentials)
# P0.3 FIX: Explicit allowlist prevents CSRF attacks
ASYNCGATE_CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080,https://yourapp.com

# CORS Settings
ASYNCGATE_CORS_ALLOW_CREDENTIALS=true
ASYNCGATE_CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
ASYNCGATE_CORS_ALLOWED_HEADERS=Authorization,Content-Type,X-Tenant-ID,X-API-Key,X-Trace-ID,X-Request-ID


# ============================================================================
# Authentication
# ============================================================================
# AsyncGate supports two authentication modes:
#
# 1. Database-backed API keys (RECOMMENDED):
#    - Keys have format: ag_<random_string>
#    - Keys are stored hashed in auth_api_keys table
#    - Use CLI or admin API to generate keys
#    - Supports per-user keys, usage tracking, revocation
#
# 2. Legacy shared token:
#    - Single shared API key for all clients
#    - Set ASYNCGATE_API_KEY environment variable
#    - For backward compatibility / simple deployments

# Legacy API Key (optional - database keys are preferred)
# ASYNCGATE_API_KEY=your-secret-api-key-here

# Allow insecure dev mode (ONLY for development)
# When true, all API requests are accepted without authentication
ASYNCGATE_ALLOW_INSECURE_DEV=false

# JWT verification (optional)
# ASYNCGATE_JWT_PUBLIC_KEY_PATH=./keys/jwt_public.pem
# ASYNCGATE_JWT_PRIVATE_KEY_PATH=./keys/jwt_private.pem


# ============================================================================
# Rate Limiting (P0.4 - Enabled by Default)
# ============================================================================
# P0.4 FIX: Rate limiting now ON by default (forced in staging/production)
ASYNCGATE_RATE_LIMIT_ENABLED=true

# Rate limit backend (memory or redis)
ASYNCGATE_RATE_LIMIT_BACKEND=memory

# Rate limit defaults (100 calls per 60 seconds)
ASYNCGATE_RATE_LIMIT_DEFAULT_CALLS=100
ASYNCGATE_RATE_LIMIT_DEFAULT_WINDOW_SECONDS=60

# Redis URL (required if using redis backend)
# ASYNCGATE_REDIS_URL=redis://localhost:6379/0


# ============================================================================
# Lease Configuration
# ============================================================================
ASYNCGATE_DEFAULT_LEASE_TTL_SECONDS=120
ASYNCGATE_MAX_LEASE_TTL_SECONDS=1800
ASYNCGATE_LEASE_SWEEP_INTERVAL_SECONDS=5


# ============================================================================
# Task Configuration
# ============================================================================
ASYNCGATE_DEFAULT_MAX_ATTEMPTS=2
ASYNCGATE_DEFAULT_RETRY_BACKOFF_SECONDS=15
ASYNCGATE_MAX_RETRY_BACKOFF_SECONDS=900


# ============================================================================
# Receipt Mode
# ============================================================================
ASYNCGATE_RECEIPT_MODE=standalone
# Options: standalone, memorygate_integrated

# MemoryGate integration (if using memorygate_integrated mode)
# ASYNCGATE_MEMORYGATE_URL=https://memorygate.fly.dev
# ASYNCGATE_MEMORYGATE_TOKEN=your-token
# ASYNCGATE_MEMORYGATE_TENANT_ID=your-tenant-id


# ============================================================================
# Escalation Routing
# ============================================================================
# Enable escalation receipts
ASYNCGATE_ESCALATION_ENABLED=false

# JSON array of escalation targets (classes 1-3, etc.)
# Example:
# ASYNCGATE_ESCALATION_TARGETS=[{"class":1,"to_kind":"agent","to_id":"ops"},{"class":2,"to_kind":"agent","to_id":"escalation"}]

# Escalation class to use for lease expiry events
ASYNCGATE_ESCALATION_LEASE_EXPIRY_CLASS=1


# ============================================================================
# Server
# ============================================================================
ASYNCGATE_HOST=0.0.0.0
ASYNCGATE_PORT=8080
